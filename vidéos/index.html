<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>HGVS – Vidéos</title>
  <link rel="stylesheet" href="../css/styles.css">
  <link rel="icon" type="image/png" href="../assets/favicon/favicon-96x96.png" sizes="96x96" />
  <link rel="icon" type="image/svg+xml" href="../assets/favicon/favicon.svg" />
  <link rel="shortcut icon" href="../assets/favicon/favicon.ico" />
  <link rel="apple-touch-icon" sizes="180x180" href="../assets/favicon/apple-touch-icon.png" />
  <meta name="apple-mobile-web-app-title" content="HGVS" />
  <link rel="manifest" href="../assets/favicon/site.webmanifest" />
</head>
<body>
  <nav class="navbar">
    <div class="container nav-container">
        <a href="../home/" class="logo-still">
            <img src="../assets/images/HGVS_logo.png" alt="HGVS Logo">
        </a>          
      <ul class="nav-links">
        <li><a href="../choix-photos/">Photos</a></li>
        <li><a href="../choix-vidéos/" class="active">Vidéos</a></li>
      </ul>
    </div>
  </nav>

  <main class="container section-dark">
    <h2>Galerie vidéos</h2>
    <div class="long-video-gallery"></div>
  </main>

  <footer class="footer-dark">
    <p>© 2025 GUILLEM Hugo – <a href="mailto:hugoguillem1@gmail.com">hugoguillem1@gmail.com</a></p>
  </footer>

  <!-- Lightbox avec lecteur vidéo -->
  <div id="lightbox" class="lightbox">
    <button id="lightbox-close" class="lightbox-close" aria-label="Fermer">×</button>
    <video controls class="lightbox-video"></video>
    <p class="lightbox-caption"></p>
  </div>

  <script>
    document.addEventListener('DOMContentLoaded', () => {
      fetch('../manifest.json')
        .then(res => res.json())
        .then(manifest => {
          const videoEntries = (manifest.videos || []).filter(v => 
            v.filename.startsWith("video_longue")
          );

          const gallery  = document.querySelector('.long-video-gallery');
          const basePath = 'https://videos-hgdevco.s3.eu-west-3.amazonaws.com/';

          videoEntries.forEach((video, index) => {
            const { filename, description } = video;

            const title = filename
              .replace(/\.(mp4|webm|ogg)$/i, '')
              .replace(/^video_longue\d+_/, '')
              .replace(/-/g, ' ');

            const row = document.createElement('div');
            row.className = 'video-row ' + (index % 2 === 0 ? 'even' : 'odd');

            const videoDiv = document.createElement('div');
            videoDiv.className = 'video-wrapper';

            const thumb = document.createElement('video');
            thumb.className    = 'video-thumb';
            thumb.src          = basePath + filename;
            thumb.muted        = true;
            thumb.playsInline  = true;
            thumb.preload      = 'metadata';
            thumb.loop         = true;

            thumb.addEventListener('loadedmetadata', () => {
              const previewTime = Math.min(2, thumb.duration / 2);
              thumb.currentTime = previewTime;
            });

            thumb.addEventListener('click', () => {
              openLightbox(basePath + filename, title);
            });

            videoDiv.appendChild(thumb);

            const descDiv = document.createElement('div');
            descDiv.className = 'video-description';
            descDiv.innerHTML = `
              <h3>${title.charAt(0).toUpperCase() + title.slice(1)}</h3>
              <p>${description || ''}</p>
            `;

            if (index % 2 === 0) {
              // pair (even) : image gauche
              row.appendChild(videoDiv);
              row.appendChild(descDiv);
            } else {
              row.appendChild(descDiv);
              row.appendChild(videoDiv);
            }

            gallery.appendChild(row);
          });
        })
        .catch(console.error);

      // lightbox setup
      const lb       = document.getElementById('lightbox');
      const lbVideo  = lb.querySelector('.lightbox-video');
      const lbCap    = lb.querySelector('.lightbox-caption');
      const closeBtn = document.getElementById('lightbox-close');

      function openLightbox(src, caption) {
        lbVideo.src       = src;
        lbCap.textContent = caption.charAt(0).toUpperCase() + caption.slice(1);
        lb.style.display  = 'flex';
        lbVideo.currentTime = 0;
        lbVideo.play();
      }

      closeBtn.addEventListener('click', () => {
        lbVideo.pause();
        lb.style.display = 'none';
      });

      document.addEventListener('keydown', e => {
        if (e.key === 'Escape') {
          lbVideo.pause();
          lb.style.display = 'none';
        }
      });
    });
  </script>

</body>
</html>
